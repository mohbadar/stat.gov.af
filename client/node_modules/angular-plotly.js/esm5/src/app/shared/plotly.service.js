/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
var PlotlyService = /** @class */ (function () {
    function PlotlyService() {
    }
    /**
     * @param {?} moduleName
     * @return {?}
     */
    PlotlyService.setModuleName = /**
     * @param {?} moduleName
     * @return {?}
     */
    function (moduleName) {
        PlotlyService._moduleName = moduleName;
    };
    /**
     * @param {?} plotly
     * @return {?}
     */
    PlotlyService.setPlotly = /**
     * @param {?} plotly
     * @return {?}
     */
    function (plotly) {
        PlotlyService._plotly = plotly;
    };
    /**
     * @param {?} instance
     * @return {?}
     */
    PlotlyService.insert = /**
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        /** @type {?} */
        var index = PlotlyService.instances.indexOf(instance);
        if (index === -1) {
            PlotlyService.instances.push(instance);
        }
        return instance;
    };
    /**
     * @param {?} div
     * @return {?}
     */
    PlotlyService.remove = /**
     * @param {?} div
     * @return {?}
     */
    function (div) {
        /** @type {?} */
        var index = PlotlyService.instances.indexOf(div);
        if (index >= 0) {
            PlotlyService.instances.splice(index, 1);
            PlotlyService._plotly.purge(div);
        }
    };
    /**
     * @param {?} id
     * @return {?}
     */
    PlotlyService.prototype.getInstanceByDivId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        var e_1, _a;
        try {
            for (var _b = tslib_1.__values(PlotlyService.instances), _c = _b.next(); !_c.done; _c = _b.next()) {
                var instance = _c.value;
                if (instance && instance.id === id) {
                    return instance;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return undefined;
    };
    /**
     * @return {?}
     */
    PlotlyService.prototype.getPlotly = /**
     * @return {?}
     */
    function () {
        if (typeof PlotlyService._plotly === 'undefined') {
            /** @type {?} */
            var msg = PlotlyService._moduleName === 'ViaCDN'
                ? "Error loading Peer dependency plotly.js from CDN url"
                : "Peer dependency plotly.js isn't installed";
            throw new Error(msg);
        }
        return PlotlyService._plotly;
    };
    /**
     * @protected
     * @param {?} fn
     * @return {?}
     */
    PlotlyService.prototype.waitFor = /**
     * @protected
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        return new Promise(function (resolve) {
            /** @type {?} */
            var localFn = function () {
                fn() ? resolve() : setTimeout(localFn, 10);
            };
            localFn();
        });
    };
    // tslint:disable max-line-length
    // tslint:disable max-line-length
    /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    PlotlyService.prototype.newPlot = 
    // tslint:disable max-line-length
    /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    function (div, data, layout, config, frames) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var obj;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.waitFor(function () { return _this.getPlotly() !== 'waiting'; })];
                    case 1:
                        _a.sent();
                        if (frames) {
                            obj = { data: data, layout: layout, config: config, frames: frames };
                            return [2 /*return*/, (/** @type {?} */ (this.getPlotly().newPlot(div, obj).then(function () { return PlotlyService.insert((/** @type {?} */ (div))); })))];
                        }
                        return [2 /*return*/, (/** @type {?} */ (this.getPlotly().newPlot(div, data, layout, config).then(function () { return PlotlyService.insert((/** @type {?} */ (div))); })))];
                }
            });
        });
    };
    /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    PlotlyService.prototype.plot = /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    function (div, data, layout, config, frames) {
        if (frames) {
            /** @type {?} */
            var obj = { data: data, layout: layout, config: config, frames: frames };
            return (/** @type {?} */ (this.getPlotly().plot(div, obj)));
        }
        return (/** @type {?} */ (this.getPlotly().plot(div, data, layout, config)));
    };
    /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    PlotlyService.prototype.update = /**
     * @param {?} div
     * @param {?} data
     * @param {?=} layout
     * @param {?=} config
     * @param {?=} frames
     * @return {?}
     */
    function (div, data, layout, config, frames) {
        if (frames) {
            /** @type {?} */
            var obj = { data: data, layout: layout, config: config, frames: frames };
            return (/** @type {?} */ (this.getPlotly().react(div, obj)));
        }
        return (/** @type {?} */ (this.getPlotly().react(div, data, layout, config)));
    };
    // tslint:enable max-line-length
    // tslint:enable max-line-length
    /**
     * @param {?} div
     * @return {?}
     */
    PlotlyService.prototype.resize = 
    // tslint:enable max-line-length
    /**
     * @param {?} div
     * @return {?}
     */
    function (div) {
        return this.getPlotly().Plots.resize(div);
    };
    PlotlyService.instances = [];
    PlotlyService._plotly = undefined;
    PlotlyService._moduleName = undefined;
    PlotlyService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */ PlotlyService.ngInjectableDef = i0.defineInjectable({ factory: function PlotlyService_Factory() { return new PlotlyService(); }, token: PlotlyService, providedIn: "root" });
    return PlotlyService;
}());
export { PlotlyService };
if (false) {
    /**
     * @type {?}
     * @protected
     */
    PlotlyService.instances;
    /**
     * @type {?}
     * @protected
     */
    PlotlyService._plotly;
    /**
     * @type {?}
     * @protected
     */
    PlotlyService._moduleName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxvdGx5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXBsb3RseS5qcy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvc2hhcmVkL3Bsb3RseS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7QUFNM0M7SUFBQTtLQWlHQzs7Ozs7SUF6RmlCLDJCQUFhOzs7O0lBQTNCLFVBQTRCLFVBQXNCO1FBQzlDLGFBQWEsQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO0lBQzNDLENBQUM7Ozs7O0lBRWEsdUJBQVM7Ozs7SUFBdkIsVUFBd0IsTUFBVztRQUMvQixhQUFhLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztJQUNuQyxDQUFDOzs7OztJQUVhLG9CQUFNOzs7O0lBQXBCLFVBQXFCLFFBQWtDOztZQUM3QyxLQUFLLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQ3ZELElBQUksS0FBSyxLQUFLLENBQUMsQ0FBQyxFQUFFO1lBQ2QsYUFBYSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDMUM7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDOzs7OztJQUVhLG9CQUFNOzs7O0lBQXBCLFVBQXFCLEdBQTZCOztZQUN4QyxLQUFLLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ2xELElBQUksS0FBSyxJQUFJLENBQUMsRUFBRTtZQUNaLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNwQztJQUNMLENBQUM7Ozs7O0lBRU0sMENBQWtCOzs7O0lBQXpCLFVBQTBCLEVBQVU7OztZQUNoQyxLQUF1QixJQUFB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QUFjLEdBQTZCLEVBQUUsSUFBbUIsRUFBRSxNQUErQixFQUFFLE1BQStCLEVBQUUsTUFBaUM7UUFDakssSUFBSSxNQUFNLEVBQUU7O2dCQUNGLEdBQUcsR0FBRyxFQUFDLElBQUksTUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFDO1lBQzFDLE9BQU8sbUJBQUEsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQWdCLENBQUM7U0FDM0Q7UUFFRCxPQUFPLG1CQUFBLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLEVBQWdCLENBQUM7SUFDN0UsQ0FBQztJQUNELGdDQUFnQzs7Ozs7O0lBRXpCLDhCQUFNOzs7Ozs7SUFBYixVQUFjLEdBQTZCO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQTVGZ0IsdUJBQVMsR0FBK0IsRUFBRSxDQUFDO0lBQzNDLHFCQUFPLEdBQVMsU0FBUyxDQUFDO0lBQzFCLHlCQUFXLEdBQWdCLFNBQVMsQ0FBQzs7Z0JBTnpELFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7Ozt3QkFSRDtDQXVHQyxBQWpHRCxJQWlHQztTQTlGWSxhQUFhOzs7Ozs7SUFDdEIsd0JBQTREOzs7OztJQUM1RCxzQkFBMkM7Ozs7O0lBQzNDLDBCQUFzRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBsb3RseSB9IGZyb20gJy4vcGxvdGx5LmludGVyZmFjZSc7XG5cbnR5cGUgUGxvdGx5TmFtZSA9ICdQbG90bHknIHwgJ1ZpYUNETicgfCAnVmlhV2luZG93JztcblxuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFBsb3RseVNlcnZpY2Uge1xuICAgIHByb3RlY3RlZCBzdGF0aWMgaW5zdGFuY2VzOiBQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnRbXSA9IFtdO1xuICAgIHByb3RlY3RlZCBzdGF0aWMgX3Bsb3RseT86IGFueSA9IHVuZGVmaW5lZDtcbiAgICBwcm90ZWN0ZWQgc3RhdGljIF9tb2R1bGVOYW1lPzogUGxvdGx5TmFtZSA9IHVuZGVmaW5lZDtcblxuICAgIHB1YmxpYyBzdGF0aWMgc2V0TW9kdWxlTmFtZShtb2R1bGVOYW1lOiBQbG90bHlOYW1lKSB7XG4gICAgICAgIFBsb3RseVNlcnZpY2UuX21vZHVsZU5hbWUgPSBtb2R1bGVOYW1lO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgc2V0UGxvdGx5KHBsb3RseTogYW55KSB7XG4gICAgICAgIFBsb3RseVNlcnZpY2UuX3Bsb3RseSA9IHBsb3RseTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGluc2VydChpbnN0YW5jZTogUGxvdGx5LlBsb3RseUhUTUxFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gUGxvdGx5U2VydmljZS5pbnN0YW5jZXMuaW5kZXhPZihpbnN0YW5jZSk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLnB1c2goaW5zdGFuY2UpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHJlbW92ZShkaXY6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLmluZGV4T2YoZGl2KTtcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIFBsb3RseVNlcnZpY2UuaW5zdGFuY2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBQbG90bHlTZXJ2aWNlLl9wbG90bHkucHVyZ2UoZGl2KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRJbnN0YW5jZUJ5RGl2SWQoaWQ6IHN0cmluZyk6IFBsb3RseS5QbG90bHlIVE1MRWxlbWVudCB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGZvciAoY29uc3QgaW5zdGFuY2Ugb2YgUGxvdGx5U2VydmljZS5pbnN0YW5jZXMpIHtcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZSAmJiBpbnN0YW5jZS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UGxvdGx5KCkge1xuICAgICAgICBpZiAodHlwZW9mIFBsb3RseVNlcnZpY2UuX3Bsb3RseSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IFBsb3RseVNlcnZpY2UuX21vZHVsZU5hbWUgPT09ICdWaWFDRE4nXG4gICAgICAgICAgICAgICAgPyBgRXJyb3IgbG9hZGluZyBQZWVyIGRlcGVuZGVuY3kgcGxvdGx5LmpzIGZyb20gQ0ROIHVybGBcbiAgICAgICAgICAgICAgICA6IGBQZWVyIGRlcGVuZGVuY3kgcGxvdGx5LmpzIGlzbid0IGluc3RhbGxlZGA7XG5cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFBsb3RseVNlcnZpY2UuX3Bsb3RseTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgd2FpdEZvcihmbjogKCkgPT4gYm9vbGVhbik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGxvY2FsRm4gPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgZm4oKSA/IHJlc29sdmUoKSA6IHNldFRpbWVvdXQobG9jYWxGbiwgMTApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbG9jYWxGbigpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZSBtYXgtbGluZS1sZW5ndGhcbiAgICBwdWJsaWMgYXN5bmMgbmV3UGxvdChkaXY6IEhUTUxEaXZFbGVtZW50LCBkYXRhOiBQbG90bHkuRGF0YVtdLCBsYXlvdXQ/OiBQYXJ0aWFsPFBsb3RseS5MYXlvdXQ+LCBjb25maWc/OiBQYXJ0aWFsPFBsb3RseS5Db25maWc+LCBmcmFtZXM/OiBQYXJ0aWFsPFBsb3RseS5Db25maWc+W10pIHtcbiAgICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yKCgpID0+IHRoaXMuZ2V0UGxvdGx5KCkgIT09ICd3YWl0aW5nJyk7XG5cbiAgICAgICAgaWYgKGZyYW1lcykge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0ge2RhdGEsIGxheW91dCwgY29uZmlnLCBmcmFtZXN9O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGxvdGx5KCkubmV3UGxvdChkaXYsIG9iaikudGhlbigoKSA9PiBQbG90bHlTZXJ2aWNlLmluc2VydChkaXYgYXMgYW55KSkgYXMgUHJvbWlzZTxhbnk+O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGxvdGx5KCkubmV3UGxvdChkaXYsIGRhdGEsIGxheW91dCwgY29uZmlnKS50aGVuKCgpID0+IFBsb3RseVNlcnZpY2UuaW5zZXJ0KGRpdiBhcyBhbnkpKSBhcyBQcm9taXNlPGFueT47XG4gICAgfVxuXG4gICAgcHVibGljIHBsb3QoZGl2OiBQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnQsIGRhdGE6IFBsb3RseS5EYXRhW10sIGxheW91dD86IFBhcnRpYWw8UGxvdGx5LkxheW91dD4sIGNvbmZpZz86IFBhcnRpYWw8UGxvdGx5LkNvbmZpZz4sIGZyYW1lcz86IFBhcnRpYWw8UGxvdGx5LkNvbmZpZz5bXSkge1xuICAgICAgICBpZiAoZnJhbWVzKSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSB7ZGF0YSwgbGF5b3V0LCBjb25maWcsIGZyYW1lc307XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQbG90bHkoKS5wbG90KGRpdiwgb2JqKSBhcyBQcm9taXNlPGFueT47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5nZXRQbG90bHkoKS5wbG90KGRpdiwgZGF0YSwgbGF5b3V0LCBjb25maWcpIGFzIFByb21pc2U8YW55PjtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlKGRpdjogUGxvdGx5LlBsb3RseUhUTUxFbGVtZW50LCBkYXRhOiBQbG90bHkuRGF0YVtdLCBsYXlvdXQ/OiBQYXJ0aWFsPFBsb3RseS5MYXlvdXQ+LCBjb25maWc/OiBQYXJ0aWFsPFBsb3RseS5Db25maWc+LCBmcmFtZXM/OiBQYXJ0aWFsPFBsb3RseS5Db25maWc+W10pIHtcbiAgICAgICAgaWYgKGZyYW1lcykge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0ge2RhdGEsIGxheW91dCwgY29uZmlnLCBmcmFtZXN9O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGxvdGx5KCkucmVhY3QoZGl2LCBvYmopIGFzIFByb21pc2U8YW55PjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFBsb3RseSgpLnJlYWN0KGRpdiwgZGF0YSwgbGF5b3V0LCBjb25maWcpIGFzIFByb21pc2U8YW55PjtcbiAgICB9XG4gICAgLy8gdHNsaW50OmVuYWJsZSBtYXgtbGluZS1sZW5ndGhcblxuICAgIHB1YmxpYyByZXNpemUoZGl2OiBQbG90bHkuUGxvdGx5SFRNTEVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGxvdGx5KCkuUGxvdHMucmVzaXplKGRpdik7XG4gICAgfVxufVxuIl19